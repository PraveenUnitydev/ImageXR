<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ImageXR Experience</title>
    
    <!-- A-Frame and MindAR Scripts -->
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <!-- Vanta.js Animation Scripts -->
    <script src="vanta/three.r134.min.js"></script>
    <script src="vanta/vanta.birds.min.js"></script>
    
    <!-- Your CSS file -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Upload Screen -->
    <div id="uploadScreen" class="screen active">
      <!-- Vanta.js background container -->
      <div id="vanta-background" class="vanta-bg"></div>
      
      <div class="upload-container">
        <h2> Upload Required Files</h2>
        <div class="upload-group">
          <label for="modelInput">🎯 3D Model (.glb/.gltf)</label>
          <div class="file-input-wrapper">
            <input type="file" id="modelInput" accept=".glb,.gltf" />
            <div class="file-input-button" data-input="modelInput">
              <span class="icon">📦</span>
              <span class="text">Choose 3D Model File</span>
            </div>
          </div>
        </div>
        <div class="upload-group">
         <label for="mindInput">
  🧠 Mind Tracking File
  <a href="https://hiukim.github.io/mind-ar-js-doc/tools/compile/" target="_blank" style="margin-left: 6px; color: #fff; text-decoration: none;" title="How to generate .mind file">
    <span style="background: rgba(255,255,255,0.2); border-radius: 50%; padding: 2px 6px; font-weight: bold;">?</span>
  </a>
</label>

          <div class="file-input-wrapper">
            <input type="file" id="mindInput" accept=".mind" />
            <div class="file-input-button" data-input="mindInput">
              <span class="icon">🔮</span>
              <span class="text">Choose .mind File</span>
            </div>
          </div>
        </div>
        <div class="upload-group">
          <label for="imageInput">🖼️ Target Image (PNG/JPG)</label>
          <div class="file-input-wrapper">
            <input type="file" id="imageInput" accept=".png,.jpg,.jpeg" />
            <div class="file-input-button" data-input="imageInput">
              <span class="icon">🎨</span>
              <span class="text">Choose Target Image</span>
            </div>
          </div>
        </div>
        <button 
  onclick="window.location.href='/sample-assets/samples.zip'" 
  style="margin-top: 16px; padding: 12px 20px; font-size: 13px; border-radius: 12px; background: rgba(255, 255, 255, 0.12); color: #fff; border: 1px solid rgba(255,255,255,0.3); cursor: pointer; transition: all 0.3s ease;"
>
  ⬇️ Download Sample Assets
</button>

        <button id="startARBtn" disabled>🚀 Launch AR Experience</button>
        <div id="status">Please upload all required files to begin your AR journey</div>
      </div>
    </div>

    <!-- AR Experience Screen -->
    <div id="arScreen" class="screen">
      <button id="backBtn" class="back-button">← Back to Upload</button>
      
      <a-scene 
        id="arScene"
        shadow="type: pcfsoft; autoUpdate: true"
        renderer="antialias: true; shadowMap.enabled: true; shadowMap.type: PCFSoftShadowMap; shadowMap.autoUpdate: true; gammaOutput: true"
        xr-mode-ui="enabled: true"
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false">

        <!-- Lights -->
        <a-entity id="mainLight" light="type: directional; castShadow: true; intensity: 1.2; color: #FFFFFF;
          shadowCameraVisible: false; shadowCameraLeft: -20; shadowCameraRight: 20;
          shadowCameraTop: 20; shadowCameraBottom: -20; shadowCameraNear: 0.1; shadowCameraFar: 50;
          shadowMapWidth: 2048; shadowMapHeight: 2048; shadowBias: -0.0001" position="8 12 5"></a-entity>

        <a-entity light="type: ambient; intensity: 0.6; color: #B8D4FF"></a-entity>
        <a-entity light="type: directional; intensity: 0.3; color: #FFF8DC; castShadow: false" position="-8 7 -8"></a-entity>

        <a-assets>
          <img id="card" src="" crossorigin="anonymous" />
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false" arjs-look-controls="smoothingFactor: 0.1"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
          <a-gltf-model 
            id="uploadedModel"
            rotation="90 0 0" 
            position="0 0.2 0" 
            scale="0.1 0.1 0.1" 
            visible="false"
            shadow="cast: true; receive: false">
          </a-gltf-model>
          
          <a-plane 
            id="fallbackPlane"
            position="0 0 0" 
            rotation="-90 0 0" 
            width="1" 
            height="1" 
            color="#4CC3D9" 
            opacity="0.7"
            visible="false">
            <a-text 
              value="AR Target Found!" 
              color="#FFF" 
              position="0 0 0.01">
            </a-text>
          </a-plane>
        </a-entity>
      </a-scene>
    </div>

    <script src="main.js"></script>
    
    <script>
      document.querySelectorAll('.file-input-button').forEach(button => {
        const inputId = button.getAttribute('data-input');
        const input = document.getElementById(inputId);
        const textSpan = button.querySelector('.text');
        
        button.setAttribute('data-original-text', textSpan.textContent);
        
        button.addEventListener('click', () => input.click());
        
        input.addEventListener('change', function() {
          if (this.files.length > 0) {
            button.classList.add('has-file');
            textSpan.textContent = `✓ ${this.files[0].name}`;
          } else {
            button.classList.remove('has-file');
            textSpan.textContent = button.getAttribute('data-original-text');
          }
        });
      });
    </script>
    
    <script>
      let vantaEffect = null;
      
      function initVantaAnimation() {
        if (typeof THREE === 'undefined' || typeof VANTA === 'undefined' || !VANTA.BIRDS) return;
        
        const targetElement = document.getElementById('vanta-background');
        if (!targetElement) return;
        
        if (vantaEffect) vantaEffect.destroy();
        
        try {
          vantaEffect = VANTA.BIRDS({
            el: "#vanta-background",
            mouseControls: true,
            touchControls: true,
            gyroControls: false,
            minHeight: window.innerHeight,
            minWidth: window.innerWidth,
            scale: 1.00,
            scaleMobile: 1.00,
            wingSpan: 32.00,
            separation: 70.00,
            backgroundColor: 0x1a1a2e,
            color1: 0xff6b6b,
            color2: 0x4ecdc4,
            birdSize: 1.5,
            speedLimit: 3.00,
            quantity: 4.00
          });
        } catch (error) {
          console.error('Error initializing Vanta:', error);
        }
      }
      
      function destroyVantaAnimation() {
        if (vantaEffect) {
          try {
            vantaEffect.destroy();
            vantaEffect = null;
          } catch (error) {
            console.error('Error destroying Vanta:', error);
          }
        }
      }
      
      function waitForScripts() {
        let attempts = 0;
        const maxAttempts = 30;
        
        const checkInterval = setInterval(() => {
          attempts++;
          if (typeof THREE !== 'undefined' && typeof VANTA !== 'undefined' && VANTA && VANTA.BIRDS) {
            clearInterval(checkInterval);
            initVantaAnimation();
          } else if (attempts >= maxAttempts) {
            clearInterval(checkInterval);
          }
        }, 100);
      }
      
      document.addEventListener('DOMContentLoaded', waitForScripts);
      
      document.addEventListener('screenChange', function(e) {
        if (e.detail.screen === 'ar') {
          destroyVantaAnimation();
        } else if (e.detail.screen === 'upload') {
          setTimeout(initVantaAnimation, 100);
        }
      });
      
      window.addEventListener('load', function() {
        if (!vantaEffect) setTimeout(waitForScripts, 500);
      });
    </script>
  </body>
</html>